---
page_title: upstream_input block reference for Terraform Stack deployments
description: Use the `upstream_input` block to consume outputs from another Stack in the same project and use them as inputs in your current Stack.
---

# `upstream_input` block reference

Use the `upstream_input` block to consume outputs from another Stack in the same project and use them as inputs in your current Stack.

> **Hands-on:** Try the [Pass Data Between Stacks](/terraform/tutorials/stacks/pass-data-between-stacks) tutorial.

## Background

The `upstream_input` block specifies another Stack in the same project to consume outputs from. You declare an `upstream_input` block for each Stack you want to reference. When an output from an upstream Stack changes, HCP Terraform automatically triggers runs for any Stacks that depend on those outputs.

Upstream inputs enable you to create dependencies between Stacks, allowing you to share data such as VPC IDs, database endpoints, or other infrastructure details between different parts of your infrastructure.

<Note>

The `upstream_input` block requires Terraform version 1.10.0-alpha20241009 or higher.

</Note>

## Configuration model

The `upstream_input` block supports the following arguments:

- [`upstream_input "<LABEL>"`](#upstream_input) &nbsp; block
  - [`type`](#type) &nbsp; string
  - [`source`](#source) &nbsp; string

## Complete configuration

All available arguments are defined in the following `upstream_input` block:

```hcl
upstream_input "<LABEL>" {
  type   = "stack"
  source = "app.terraform.io/<ORGANIZATION>/<PROJECT>/<STACK_NAME>"
}
```

## Specification

An `upstream_input` block supports the following configuration.

### `upstream_input "<LABEL>"`

The label after the `upstream_input` keyword is a name for the upstream input, which must be unique among all upstream inputs in the same deployment configuration file. The name can be any valid [identifier](/terraform/language/syntax/configuration#identifiers).

The following arguments are supported in an `upstream_input` block:

| Argument | Description | Type | Required? |
| --- | --- | --- | --- |
| `type` | The type of upstream source. Currently only "stack" is supported. | String | Required |
| `source` | The upstream Stack's URL in the specified format. | String | Required |

### `type`

The `type` argument specifies the type of upstream source you want to consume from. Currently, only `"stack"` is supported as a type value.

```hcl
upstream_input "network_stack" {
  type   = "stack"
  source = "app.terraform.io/myorg/myproject/networking"
}
```

#### Summary

- Data type: String
- Default: None
- Required: Yes
- Valid values: `"stack"`

### `source`

The `source` argument specifies the upstream Stack's URL in the format `"app.terraform.io/{organization_name}/{project_name}/{upstream_stack_name}"`. This URL identifies the specific Stack you want to consume outputs from.

```hcl
upstream_input "database_stack" {
  type   = "stack"
  source = "app.terraform.io/hashicorp/infrastructure/database-stack"
}
```

The source URL must reference a Stack that exists in the same project as your current Stack.

#### Summary

- Data type: String
- Default: None
- Required: Yes

## Accessing upstream outputs

After defining an `upstream_input` block, you can access published outputs from the upstream Stack using the syntax `upstream_input.<LABEL>.<OUTPUT_NAME>`.

```hcl
upstream_input "network_stack" {
  type   = "stack"
  source = "app.terraform.io/myorg/myproject/networking"
}

deployment "application" {
  inputs = {
    vpc_id     = upstream_input.network_stack.vpc_id
    subnet_ids = upstream_input.network_stack.private_subnet_ids
  }
}
```

## Examples

The following examples demonstrate common use cases for `upstream_input` blocks.

### Basic upstream input

In the following example, an application Stack consumes VPC information from a networking Stack:

```hcl
upstream_input "network_stack" {
  type   = "stack"
  source = "app.terraform.io/myorg/myproject/networking"
}

deployment "application" {
  inputs = {
    vpc_id           = upstream_input.network_stack.vpc_id
    private_subnet_ids = upstream_input.network_stack.private_subnet_ids
    security_group_id  = upstream_input.network_stack.default_security_group_id
  }
}
```

### Multiple upstream inputs

In the following example, a Stack consumes outputs from multiple upstream Stacks:

```hcl
upstream_input "network_stack" {
  type   = "stack"
  source = "app.terraform.io/myorg/infrastructure/networking"
}

upstream_input "database_stack" {
  type   = "stack"
  source = "app.terraform.io/myorg/infrastructure/database"
}

deployment "application" {
  inputs = {
    # From networking Stack
    vpc_id     = upstream_input.network_stack.vpc_id
    subnet_ids = upstream_input.network_stack.app_subnet_ids

    # From database Stack
    database_url      = upstream_input.database_stack.connection_string
    database_port     = upstream_input.database_stack.port
    database_security_group = upstream_input.database_stack.security_group_id
  }
}
```

### Environment-specific upstream inputs

In the following example, different deployments consume from environment-specific upstream Stacks:

```hcl
upstream_input "staging_network" {
  type   = "stack"
  source = "app.terraform.io/myorg/staging/networking"
}

upstream_input "production_network" {
  type   = "stack"
  source = "app.terraform.io/myorg/production/networking"
}

deployment "staging_app" {
  inputs = {
    vpc_id     = upstream_input.staging_network.vpc_id
    subnet_ids = upstream_input.staging_network.private_subnet_ids
    environment = "staging"
  }
}

deployment "production_app" {
  inputs = {
    vpc_id     = upstream_input.production_network.vpc_id
    subnet_ids = upstream_input.production_network.private_subnet_ids
    environment = "production"
  }
}
```

### Complex upstream data consumption

In the following example, a Stack consumes complex configuration objects from upstream Stacks:

```hcl
upstream_input "shared_services" {
  type   = "stack"
  source = "app.terraform.io/myorg/platform/shared-services"
}

deployment "microservice" {
  inputs = {
    # Consume entire configuration objects
    database_config = upstream_input.shared_services.database_config
    monitoring_config = upstream_input.shared_services.monitoring_config

    # Consume specific values
    service_mesh_endpoint = upstream_input.shared_services.service_mesh_url
    log_aggregator_url    = upstream_input.shared_services.logging_endpoint
  }
}
```

### Upstream input with local processing

In the following example, upstream values are processed using local values before being used in deployments:

```hcl
upstream_input "network_stack" {
  type   = "stack"
  source = "app.terraform.io/myorg/infrastructure/networking"
}

locals {
  # Process upstream subnet IDs to select only private subnets
  private_subnets = [
    for subnet_id in upstream_input.network_stack.all_subnet_ids :
    subnet_id if contains(upstream_input.network_stack.private_subnet_ids, subnet_id)
  ]
}

deployment "application" {
  inputs = {
    vpc_id     = upstream_input.network_stack.vpc_id
    subnet_ids = local.private_subnets
  }
}
```
