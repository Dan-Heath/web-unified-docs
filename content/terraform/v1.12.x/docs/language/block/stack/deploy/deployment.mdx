---
page_title: Deployment block reference for Terraform Stacks
description: Use the `deployment` block to define how many times you want to deploy your Stack's infrastructure. Each deployment runs in its own isolated agent.
---

# `deployment` block reference

Use the `deployment` block to define how many times you want to deploy your Stack's infrastructure. Each deployment runs in its own isolated agent, wholly separated from other Stack deployments.

> **Hands-on:** Try the [Define Deployment Configuration](/terraform/tutorials/stacks/define-deployment-configuration) tutorial.

## Background

The `deployment` block defines how to deploy your Stack's infrastructure. Each Stack requires at least one `deployment` block, and you can add additional `deployment` blocks every time you want to deploy your Stack's infrastructure again with different input values.

Each deployment represents a separate instance of your Stack infrastructure. For example, you might have deployments for staging, production, and development environments, each with different variable values but using the same Stack configuration.

<Note>

HCP Terraform supports up to a maximum of 20 deployments per Stack.

</Note>

## Configuration model

The `deployment` block supports the following arguments:

- [`deployment "<LABEL>"`](#deployment) &nbsp; block
  - [`inputs`](#inputs) &nbsp; map

## Complete configuration

All available arguments are defined in the following `deployment` block:

```hcl
deployment "<LABEL>" {
  inputs = {
    <VARIABLE_NAME> = <VALUE>
  }
}
```

## Specification

A `deployment` block supports the following configuration.

### `deployment "<LABEL>"`

The label after the `deployment` keyword is a name for the deployment, which must be unique among all deployments in the same deployment configuration file. The name of a deployment can be any valid [identifier](/terraform/language/syntax/configuration#identifiers).

The following arguments are supported in a `deployment` block:

| Argument | Description | Type | Required? |
| --- | --- | --- | --- |
| `inputs` | A mapping of Stack variable names to values for this deployment. | Map | Required |

### `inputs`

The `inputs` argument defines a mapping of Stack variable names to values for this specific deployment. The keys in this map must correspond to the names of variables defined in your Stack configuration, and the values must be valid HCL literals that meet the type constraints of those variables.

```hcl
deployment "production" {
  inputs = {
    aws_region     = "us-west-1"
    instance_count = 2
    environment    = "prod"
  }
}
```

You can use various types of values in the `inputs` map:

- **Literal values**: Direct HCL values such as strings, numbers, booleans, lists, or objects
- **Store references**: Values from `store` blocks like `store.varset.tokens.api_key`
- **Identity token references**: JWT tokens from `identity_token` blocks like `identity_token.aws.jwt`
- **Upstream inputs**: Values from other Stacks using `upstream_input` blocks

#### Summary

- Data type: Map
- Default: None
- Required: Yes

## Examples

The following examples demonstrate common use cases for `deployment` blocks.

### Basic deployment

In the following example, a `deployment` block defines a production deployment with specific input values:

```hcl
deployment "production" {
  inputs = {
    aws_region     = "us-west-1"
    instance_count = 2
    environment    = "production"
  }
}
```

### Multiple deployments

In the following example, multiple deployment blocks define different environments with varying configurations:

```hcl
deployment "staging" {
  inputs = {
    aws_region     = "us-east-1"
    instance_count = 1
    environment    = "staging"
  }
}

deployment "production" {
  inputs = {
    aws_region     = "us-west-1"
    instance_count = 3
    environment    = "production"
  }
}
```

### Deployment with store references

In the following example, a deployment uses values from a variable set store:

```hcl
store "varset" "secrets" {
  id       = "varset-abc123"
  category = "terraform"
}

deployment "production" {
  inputs = {
    database_password = store.varset.secrets.db_password
    api_key          = store.varset.secrets.api_key
    instance_count   = 5
  }
}
```

### Deployment with identity tokens

In the following example, a deployment uses an identity token for OIDC authentication:

```hcl
identity_token "aws" {
  audience = ["aws.workload.identity"]
}

deployment "production" {
  inputs = {
    aws_region = "us-west-2"
    role_arn   = "arn:aws:iam::123456789012:role/my-oidc-role"
    aws_token  = identity_token.aws.jwt
  }
}
```

### Deployment with upstream inputs

In the following example, a deployment consumes outputs from another Stack:

```hcl
upstream_input "network_stack" {
  type   = "stack"
  source = "app.terraform.io/myorg/myproject/networking"
}

deployment "application" {
  inputs = {
    vpc_id           = upstream_input.network_stack.vpc_id
    subnet_ids       = upstream_input.network_stack.private_subnet_ids
    instance_count   = 3
  }
}
```
