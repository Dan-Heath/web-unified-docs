---
page_title: Identity token block reference for Terraform Stacks
description: Use the `identity_token` block to define JSON Web Tokens (JWT) that Terraform generates for OIDC authentication with cloud providers.
---

# `identity_token` block reference

Use the `identity_token` block to define JSON Web Tokens (JWT) that Terraform generates for OIDC authentication with cloud providers and other services.

> **Hands-on:** Try the [Authenticate a Stack](/terraform/tutorials/stacks/authenticate-stack) tutorial.

## Background

The `identity_token` block defines a JSON Web Token (JWT) that Terraform generates for a given deployment. You can reference these tokens in your deployment's `inputs` and pass them directly to provider configurations for OpenID Connect (OIDC) authentication.

Identity tokens provide a secure way to authenticate your Stack deployments with cloud providers without storing long-lived credentials. Each token is generated dynamically when needed and includes claims that identify the specific deployment and Stack.

## Configuration model

The `identity_token` block supports the following arguments:

- [`identity_token "<LABEL>"`](#identity_token) &nbsp; block
  - [`audience`](#audience) &nbsp; set of strings

## Complete configuration

All available arguments are defined in the following `identity_token` block:

```hcl
identity_token "<LABEL>" {
  audience = ["<AUDIENCE_VALUE>"]
}
```

## Specification

An `identity_token` block supports the following configuration.

### `identity_token "<LABEL>"`

The label after the `identity_token` keyword is a name for the identity token, which must be unique among all identity tokens in the same deployment configuration file. The name can be any valid [identifier](/terraform/language/syntax/configuration#identifiers).

The following arguments are supported in an `identity_token` block:

| Argument | Description | Type | Required? |
| --- | --- | --- | --- |
| `audience` | The audience that this token is intended for. | Set of strings | Required |

### `audience`

The `audience` argument specifies the intended audience for the identity token. The audience represents the resource or service that will use this token after Terraform generates it. You specify an audience to ensure that the cloud service authorizing the workload is confident that the token you present is intended for that service.

```hcl
identity_token "aws" {
  audience = ["aws.workload.identity"]
}
```

The audience value must match the audience expected by the target service. For example, AWS workload identity typically expects `"aws.workload.identity"` as the audience value.

#### Summary

- Data type: Set of strings
- Default: None
- Required: Yes

## Token attributes

Once defined, you can reference an identity token's attributes in your deployment configuration:

| Attribute | Description | Type |
| --- | --- | --- |
| `jwt` | The generated JSON Web Token that you can use for authentication. | String |

## Examples

The following examples demonstrate common use cases for `identity_token` blocks.

### AWS OIDC authentication

In the following example, an identity token is configured for AWS workload identity and used in a deployment:

```hcl
identity_token "aws" {
  audience = ["aws.workload.identity"]
}

deployment "production" {
  inputs = {
    aws_region = "us-west-2"
    role_arn   = "arn:aws:iam::123456789012:role/my-oidc-role"
    aws_token  = identity_token.aws.jwt
  }
}
```

In your Stack configuration, you can use this token to configure the AWS provider:

```hcl
variable "aws_token" {
  type      = string
  ephemeral = true
}

variable "role_arn" {
  type = string
}

provider "aws" "main" {
  config {
    region = var.aws_region
    assume_role_with_web_identity {
      role_arn           = var.role_arn
      web_identity_token = var.aws_token
    }
  }
}
```

### Multiple cloud providers

In the following example, separate identity tokens are configured for different cloud providers:

```hcl
identity_token "aws" {
  audience = ["aws.workload.identity"]
}

identity_token "gcp" {
  audience = ["gcp.workload.identity"]
}

deployment "multi_cloud" {
  inputs = {
    aws_token = identity_token.aws.jwt
    gcp_token = identity_token.gcp.jwt
    aws_role  = "arn:aws:iam::123456789012:role/terraform-role"
    gcp_sa    = "terraform@my-project.iam.gserviceaccount.com"
  }
}
```

### Multiple audiences

In the following example, an identity token is configured with multiple audience values:

```hcl
identity_token "multi_service" {
  audience = [
    "primary.service.identity",
    "secondary.service.identity"
  ]
}

deployment "staging" {
  inputs = {
    auth_token = identity_token.multi_service.jwt
  }
}
```

### Environment-specific tokens

In the following example, different identity tokens are configured for different environments:

```hcl
identity_token "staging_aws" {
  audience = ["aws.workload.identity"]
}

identity_token "production_aws" {
  audience = ["aws.workload.identity"]
}

deployment "staging" {
  inputs = {
    aws_token = identity_token.staging_aws.jwt
    role_arn  = "arn:aws:iam::123456789012:role/staging-role"
  }
}

deployment "production" {
  inputs = {
    aws_token = identity_token.production_aws.jwt
    role_arn  = "arn:aws:iam::123456789012:role/production-role"
  }
}
```
