---
page_title: Provider block reference for Terraform Stacks
description: Use the `provider` block in Stack configurations to configure providers for your Stack components. Stack provider blocks differ from traditional Terraform with config blocks and for_each support.
---

# `provider` block reference for Stacks

Use the `provider` block in Stack configurations to configure providers for your Stack components. Stack provider blocks have several key differences from traditional Terraform provider configurations.

> **Hands-on:** Try the [Declare Providers](/terraform/tutorials/stacks/declare-providers) tutorial.

## Background

The `provider` block in Stack configurations configures providers that your Stack components use. Unlike traditional Terraform configurations, Stack provider blocks have several important differences:

- Providers support the `for_each` meta-argument for dynamic provider configurations
- Provider aliases are defined in the block header rather than as an argument
- Provider arguments use a `config` block instead of direct arguments
- You must define providers at the top level of your Stack configuration - components cannot declare their own providers

After defining providers, you pass them to your Stack's `component` blocks using the `providers` argument. This ensures that all components in your Stack use consistently configured providers.

## Configuration model

The `provider` block supports the following arguments:

- [`provider "<PROVIDER_NAME>" "<ALIAS>"`](#provider) &nbsp; block
  - [`config`](#config) &nbsp; block
  - [`for_each`](#for_each) &nbsp; meta-argument

## Complete configuration

All available arguments are defined in the following `provider` block:

```hcl
provider "<PROVIDER_NAME>" "<ALIAS>" {
  for_each = <MAP_OR_SET>
  
  config {
    <PROVIDER_ARGUMENTS>
  }
}
```

## Specification

A `provider` block supports the following configuration.

### `provider "<PROVIDER_NAME>" "<ALIAS>"`

The `provider` block requires two labels: the provider name and an alias. The provider name must match a provider declared in your `required_providers` block. The alias serves as a unique identifier for this specific provider configuration.

The following arguments are supported in a `provider` block:

| Argument | Description | Type | Required? |
| --- | --- | --- | --- |
| `config` | A block containing the provider's configuration arguments. | Block | Required |
| `for_each` | Creates multiple instances of the provider configuration based on a map or set. | Map or Set | Optional |

### `config`

The `config` block contains the configuration arguments for the provider. These arguments are specific to each provider and are documented by the provider developer.

```hcl
provider "aws" "main" {
  config {
    region = var.aws_region
    
    assume_role_with_web_identity {
      role_arn           = var.role_arn
      web_identity_token = var.identity_token
    }
    
    default_tags {
      tags = var.default_tags
    }
  }
}
```

Unlike traditional Terraform configurations where provider arguments are specified directly in the provider block, Stack configurations require all provider arguments to be nested within a `config` block.

#### Summary

- Data type: Block
- Default: None
- Required: Yes

### `for_each`

The `for_each` meta-argument creates multiple instances of a provider configuration based on a map or set of values. This is particularly useful for multi-region or multi-account deployments.

```hcl
provider "aws" "configurations" {
  for_each = var.regions
  
  config {
    region = each.value
    
    assume_role_with_web_identity {
      role_arn           = var.role_arn
      web_identity_token = var.identity_token
    }
  }
}
```

When you use `for_each`, you can reference individual provider instances using `provider.<PROVIDER_NAME>.<ALIAS>[<KEY>]` syntax in your component blocks.

#### Summary

- Data type: Map or Set
- Default: None

## Using providers in components

After defining providers, you pass them to your `component` blocks using the `providers` argument:

```hcl
component "storage" {
  source = "./modules/s3"
  
  providers = {
    aws = provider.aws.main
  }
  
  inputs = {
    bucket_name = "my-bucket"
  }
}
```

For providers using `for_each`, reference specific instances:

```hcl
component "regional_storage" {
  for_each = var.regions
  
  source = "./modules/s3"
  
  providers = {
    aws = provider.aws.configurations[each.value]
  }
  
  inputs = {
    region      = each.value
    bucket_name = "my-bucket-${each.value}"
  }
}
```

## Examples

The following examples demonstrate common use cases for `provider` blocks in Stacks.

### Basic provider configuration

In the following example, a simple AWS provider is configured for a Stack:

```hcl
required_providers {
  aws = {
    source  = "hashicorp/aws"
    version = "~> 5.7.0"
  }
}

provider "aws" "main" {
  config {
    region = var.aws_region
    
    assume_role_with_web_identity {
      role_arn           = var.role_arn
      web_identity_token = var.identity_token
    }
  }
}
```

### Multi-region provider configuration

In the following example, dynamic provider configurations are created for multiple AWS regions:

```hcl
required_providers {
  aws = {
    source  = "hashicorp/aws"
    version = "~> 5.7.0"
  }
}

provider "aws" "regional" {
  for_each = var.regions
  
  config {
    region = each.value
    
    assume_role_with_web_identity {
      role_arn           = var.role_arn
      web_identity_token = var.identity_token
    }
    
    default_tags {
      tags = {
        Environment = var.environment
        Region      = each.value
      }
    }
  }
}
```

### Multiple provider types

In the following example, multiple different providers are configured for a Stack:

```hcl
required_providers {
  aws = {
    source  = "hashicorp/aws"
    version = "~> 5.7.0"
  }
  random = {
    source  = "hashicorp/random"
    version = "~> 3.5.1"
  }
  tls = {
    source  = "hashicorp/tls"
    version = "~> 4.0"
  }
}

provider "aws" "main" {
  config {
    region = var.aws_region
    
    assume_role_with_web_identity {
      role_arn           = var.role_arn
      web_identity_token = var.identity_token
    }
  }
}

provider "random" "main" {
  config {}
}

provider "tls" "main" {
  config {}
}
```

### Environment-specific providers

In the following example, different provider configurations are used for different environments:

```hcl
provider "aws" "staging" {
  config {
    region = "us-east-1"
    
    assume_role_with_web_identity {
      role_arn           = var.staging_role_arn
      web_identity_token = var.identity_token
    }
    
    default_tags {
      tags = {
        Environment = "staging"
      }
    }
  }
}

provider "aws" "production" {
  config {
    region = "us-west-2"
    
    assume_role_with_web_identity {
      role_arn           = var.production_role_arn
      web_identity_token = var.identity_token
    }
    
    default_tags {
      tags = {
        Environment = "production"
      }
    }
  }
}
```

### Provider with complex configuration

In the following example, an AWS provider is configured with multiple authentication and configuration options:

```hcl
provider "aws" "main" {
  config {
    region = var.aws_region
    
    assume_role_with_web_identity {
      role_arn               = var.role_arn
      web_identity_token     = var.identity_token
      session_name           = "terraform-stack-session"
      duration_seconds       = 3600
    }
    
    default_tags {
      tags = var.default_tags
    }
    
    retry_mode      = "adaptive"
    max_retries     = 3
    
    ignore_tags {
      key_prefixes = ["auto-"]
      keys         = ["CreatedBy"]
    }
  }
}
```