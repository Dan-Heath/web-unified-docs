---
page_title: Removed block reference for Terraform Stacks
description: Use the `removed` block to systematically remove components from your Stack configuration while ensuring HCP Terraform can properly clean up resources.
---

# `removed` block reference for Stacks

Use the `removed` block to systematically remove components from your Stack configuration while ensuring HCP Terraform can properly clean up resources.

## Background

Stacks take a systematic approach to removing components from your configuration. When you want to remove a component from a Stack, you cannot simply delete the `component` block. Instead, you must use the `removed` block to ensure HCP Terraform knows which components to remove and which providers it requires to remove that component properly.

The `removed` block tells HCP Terraform to destroy the resources managed by a specific component while maintaining the provider configurations needed for the cleanup operation. This ensures that resources are properly destroyed before the component configuration is completely removed from your Stack.

<Warning>

Do not remove providers from your Stack configuration without first removing the components that require those providers. HCP Terraform requires a component's providers to ensure it can successfully remove that component.

</Warning>

## Configuration model

The `removed` block supports the following arguments:

- [`removed`](#removed) &nbsp; block
  - [`source`](#source) &nbsp; string
  - [`from`](#from) &nbsp; reference
  - [`providers`](#providers) &nbsp; map
  - [`for_each`](#for_each) &nbsp; meta-argument

## Complete configuration

All available arguments are defined in the following `removed` block:

```hcl
removed {
  for_each = <MAP_OR_SET>
  
  source = "<MODULE_SOURCE>"
  from   = component.<COMPONENT_NAME>
  
  providers = {
    <PROVIDER_NAME> = provider.<PROVIDER_TYPE>.<ALIAS>
  }
}
```

## Specification

A `removed` block supports the following configuration.

### `removed`

The `removed` block does not take a label. Each `removed` block represents a component or set of components that you want to remove from your Stack.

The following arguments are supported in a `removed` block:

| Argument | Description | Type | Required? |
| --- | --- | --- | --- |
| `source` | The source module of the component you want to remove. | String | Required |
| `from` | A reference to the component you want to remove. | Reference | Required |
| `providers` | A mapping of provider names to the providers that the component uses. | Map | Required |
| `for_each` | Creates multiple removal operations based on a map or set. | Map or Set | Optional |

### `source`

The `source` argument specifies the source module of the component you want to remove. This must match the `source` argument from the original `component` block.

```hcl
removed {
  source = "./modules/database"
  from   = component.database
  
  providers = {
    aws = provider.aws.main
  }
}
```

#### Summary

- Data type: String
- Default: None
- Required: Yes

### `from`

The `from` argument specifies a reference to the component you want to remove. Use the syntax `component.<COMPONENT_NAME>` to reference the component.

```hcl
removed {
  source = "./modules/storage"
  from   = component.storage
  
  providers = {
    aws = provider.aws.main
  }
}
```

For components that use `for_each`, reference specific instances:

```hcl
removed {
  source = "./modules/regional-storage"
  from   = component.regional_storage["us-west-1"]
  
  providers = {
    aws = provider.aws.configurations["us-west-1"]
  }
}
```

#### Summary

- Data type: Reference
- Default: None
- Required: Yes

### `providers`

The `providers` argument defines a mapping of provider names to the providers that the component you want to remove uses. HCP Terraform needs these provider configurations to properly remove the component's resources.

```hcl
removed {
  source = "./modules/web-app"
  from   = component.web_app
  
  providers = {
    aws    = provider.aws.main
    random = provider.random.main
  }
}
```

The provider mapping must include all providers that the component's module requires for resource destruction.

#### Summary

- Data type: Map
- Default: None
- Required: Yes

### `for_each`

The `for_each` meta-argument supports removing multiple components that were created using `for_each`. This is useful when you want to remove components from specific regions or environments.

```hcl
removed {
  for_each = var.regions_to_remove
  
  source = "./modules/regional-app"
  from   = component.regional_app[each.value]
  
  providers = {
    aws = provider.aws.configurations[each.value]
  }
}
```

#### Summary

- Data type: Map or Set
- Default: None

## Removal workflow

To properly remove a component from your Stack, follow this workflow:

1. **Add a `removed` block** for the component you want to remove
2. **Apply the configuration** to destroy the component's resources
3. **Remove both the `component` and `removed` blocks** from your configuration
4. **Apply again** to complete the removal

## Examples

The following examples demonstrate common use cases for `removed` blocks.

### Basic component removal

In the following example, a database component is marked for removal:

```hcl
# Original component (to be removed)
component "database" {
  source = "./modules/database"
  
  inputs = {
    instance_class = "db.t3.micro"
  }
  
  providers = {
    aws = provider.aws.main
  }
}

# Removal block
removed {
  source = "./modules/database"
  from   = component.database
  
  providers = {
    aws = provider.aws.main
  }
}
```

### Removing regional components

In the following example, components from specific regions are removed using `for_each`:

```hcl
# Original regional components
component "regional_storage" {
  for_each = var.regions
  
  source = "./modules/s3"
  
  inputs = {
    region = each.value
  }
  
  providers = {
    aws = provider.aws.configurations[each.value]
  }
}

# Remove storage from specific regions
removed {
  for_each = var.regions_to_remove
  
  source = "./modules/s3"
  from   = component.regional_storage[each.value]
  
  providers = {
    aws = provider.aws.configurations[each.value]
  }
}
```

### Removing components with multiple providers

In the following example, a component that uses multiple providers is marked for removal:

```hcl
removed {
  source = "./modules/kubernetes-app"
  from   = component.k8s_app
  
  providers = {
    kubernetes = provider.kubernetes.main
    helm       = provider.helm.main
    random     = provider.random.main
  }
}
```

### Environment-specific removal

In the following example, components are removed from specific environments:

```hcl
# Define which environments to remove
variable "environments_to_remove" {
  type = set(string)
  default = ["development", "staging"]
}

# Original environment-specific components
component "app_environment" {
  for_each = var.environments
  
  source = "./modules/application"
  
  inputs = {
    environment = each.value
  }
  
  providers = {
    aws = provider.aws.main
  }
}

# Remove specific environments
removed {
  for_each = var.environments_to_remove
  
  source = "./modules/application"
  from   = component.app_environment[each.value]
  
  providers = {
    aws = provider.aws.main
  }
}
```

### Phased component removal

In the following example, components are removed in phases by moving them from active to removal sets:

```hcl
variable "active_regions" {
  type = set(string)
  default = ["us-east-1", "us-west-2"]
}

variable "regions_to_remove" {
  type = set(string)
  default = ["eu-west-1"] # Move regions here to remove them
}

# Active regional components
component "active_storage" {
  for_each = var.active_regions
  
  source = "./modules/s3"
  
  inputs = {
    region = each.value
  }
  
  providers = {
    aws = provider.aws.configurations[each.value]
  }
}

# Components being removed
removed {
  for_each = var.regions_to_remove
  
  source = "./modules/s3"
  from   = component.active_storage[each.value]
  
  providers = {
    aws = provider.aws.configurations[each.value]
  }
}
```