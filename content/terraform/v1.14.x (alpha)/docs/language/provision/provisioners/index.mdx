---
page_title: Use a provisioner
description: Learn how to run commands and scripts and upload files to prepare resources for service after applying the configuration with provisioners, config-init, and configuration management software.
---

# Use a provisioner

Terraform includes several built-in provisioners for helping you prepare resources for service when you cannot use machine images or configuration management.

You should exhaust all alternatives before using provisioners in your configurations.

## Requirements

- Terraform v0.9 is required to use provisioners.
- Terraform v1.10 and later is required to use ephemeral values in `provisioner` and  `connection` blocks.
- Many provisioners require access to the remote resource. Refer to [Connect to remote resources](#connect-to-remote-resources) for instructions on configuring connection settings.
- To use provisioners that upload files over SSH, the `scp` service program must be installed on the remote system.


## Add a provisioner to your resource

Add one or more `provisioner "<TYPE>"` blocks to the `resource` block you want to perform operations on. You can specify the following types:

  - `file`: Copies files or directories from the machine where Terraform is running to the new resource.
  - `local-exec`: Invokes an executable on the local machine after Terraform creates the resource.
  - `remote-exec`: Invokes an executable on the remote resource after Terraform creates the resource.

For details about each provisioner type and its arguments, refer to the [`provisioner` block reference](/terraform/language/block/resource#provisioner).

You can use ephemeral values and sensitive values in `provisioner` blocks. Refer to the following topics for more information:

- [Ephemeral values](#ephemeral-values)
- [Sensitive values](#sensitive-values)

Expressions in the `provisioner` block cannot refer to their parent resource name. Instead, use the `self` object. Refer to [References to the parent `resource`](#references-to-the-parent-resource) for more information.

All provisioners support the `when` and `on_failure` meta-arguments, which help you control when provisioners run and how they should behave when the Terraform operation fails. Refer to the following topics for more information:

- [Determine when provisioners perform tasks](#determine-when-provisioners-perform-tasks)
- [Configure provisioner failure behavior](#configure-provisioner-failure-behavior)

## Connect to remote resources

You can configure provisioners to connect to remote resources over SSH or using WinRM. Add a `connection` block to either the `provisioner` block or to the `resource` block. All provisioners in the configuration can use connection settings defined in the `resource` block. Connection settings defined in the `provisioner` block are specific to that provisioner. Refer to the [`connection` block reference](/terraform/language/block/resource#connection) for details.

Because the SSH connection type is most often used with newly-created remote resources, SSH host key validation is disabled by default. If this is not acceptable, you can establish a separate mechanism for key distribution and explicitly set the `host_key` argument to verify against a specific key or signing CA.

You can use ephemeral values in `connection` blocks. Refer to [Ephemeral values](#ephemeral-values) for more information.

Expressions in the `connection` block cannot refer to their parent resource name. Instead, you can use the `self` object. Refer to [References to the parent `resource`](#references-to-the-parent-resource) for more information.

In the following example, the `provisioner "file"` block connects to the resource as the root user over SSH and copies the `myapp.conf` file to the resource. A second `provisioner "file"` block connects to the resource as an administrator user using WinRM to copy a file to the resource's `C:/App` directory.

```hcl
provisioner "file" {
  source      = "conf/myapp.conf"
  destination = "/etc/myapp.conf"

  connection {
    type     = "ssh"
    user     = "root"
    password = var.root_password
    host     = var.host
  }
}

provisioner "file" {
  source      = "conf/myapp.conf"
  destination = "C:/App/myapp.conf"

  connection {
    type     = "winrm"
    user     = "Administrator"
    password = var.admin_password
    host     = var.host
  }
}
```

The `connection` block supports connecting to different kinds of hosts. Refer to the following topics for additional argument configurations:

- [Connect to a remote resource through a bastion host](#connect-to-a-remote-resource-through-a-bastion-host)
- [Connect to a remote resource through a proxy](#connect-to-a-remote-resource-through-a-proxy)

## Connect to a remote resource through a bastion host

Configure the following arguments in your `connection` block to establish an indirect connection with a bastion host over SSH. Refer to the [`connection` block reference](/terraform/language/block/resource#connection) for additional details:

- `bastion_host`: Set to `true` to enable the bastion host connection.
- `bastion_host_key`: Specifies the public key from the remote host or the signing CA to verify the host connection.
- `bastion_port`:  Specifies the port number to connect to.
- `bastion_user`: Specifies the user for the connection.
- `bastion_password`:	Specifies the password to use for authentication.
- `bastion_private_key`: Specifies the contents of an SSH key file. You can load keys from a file on disk using the [`file` function](/terraform/language/functions/file).
- `bastion_certificate`: Specifies the contents of a signed CA certificate.

## Connect to a remote resource through a proxy

Configure the following arguments in your `connection` block to establish a connection through an HTTP or SOCKS5 proxy over SSH. Refer to the [`connection` block reference](/terraform/language/block/resource#connection) for additional details:

- `proxy_scheme`: Specify an `http`, `https`, or `socks5` proxy.
- `proxy_host`: Specifies the proxy host name. Terraform connects to the proxy host first, then to the host specified in the  `host` or `bastion_host` arguments.
- `proxy_port`:  Specifies the port number to the proxy host.
- `proxy_user_name`: Specifies the user name to use for the connection. You only need to include this argument when authentication is required for an HTTP proxy server.
- `proxy_user_password`: Specifies the password to use for the connection. You only need to include this argument when authentication is required for the HTTP proxy server.

## References to the parent `resource`

Expressions in `provisioner` blocks and `connection` blocks cannot refer to their parent resource by name. Instead, use the special `self` object, which represents the parent `resource` block. You can use the `self` object to access all of the resource attributes. For example, use `self.public_ip` to reference an `aws_instance`'s `public_ip` attribute.

You must use the `self` object to reference the resource because using references in the configuration creates dependencies, and referring to a resource by name within its own
block would create a dependency cycle.

## Run provisioners without a resource

If you need to run provisioners that aren't directly associated with a specific resource, you can associate them with the [`terraform_data`](/terraform/language/resources/terraform-data) resource. Instances of the `terraform_data` resource implement the standard resource lifecycle, but do not manage a real infrastructure object. You can configure add `provisioner` and `connection` blocks to perform operations. You can also use its `input` argument, `triggers_replace` argument, and any meta-arguments to control exactly where in the dependency graph its provisioners run.

In the following example, the `terraform_data` resource contains a `triggers_replace` argument, which instructs Terraform to reprovision the resource when any instance of the `cluster` is replaced. Because the bootstrap script can run on any instance of the cluster, the `connection` block connects to `aws_instance.cluster[0]`, which is the first instance provisioned:

<CodeBlockConfig hideClipboard>

```hcl
resource "aws_instance" "cluster" {
  count = 3

  # ...
}

resource "terraform_data" "cluster" {
  triggers_replace = aws_instance.cluster[*].id

  connection {
    host = aws_instance.cluster[0].public_ip
  }

  provisioner "remote-exec" {
    inline = [
      "bootstrap-cluster.sh ${join(" ", aws_instance.cluster[*].private_ip)}",
    ]
  }
}
```

</CodeBlockConfig>

## Install third-party provisioners

We recommend using only provisioners built into Terraform, but you can use third-party provisioners as plugins when no other alternative is available. Place third-party provisioners into the `%APPDATA%\terraform.d\plugins` directory, `~/.terraform.d/plugins` directory, or in the directory where the Terraform binary is installed.

## Sensitive values

You can use sensitive values in `provisioner` blocks. Terraform suppresses sensitive values in all log output. Refer to [Manage sensitive data](/terraform/language/manage-sensitive-data) for more information about using sensitive values in your configurations.

### Ephemeral values

You can use ephemeral values in `provisioner` blocks and `connection` blocks that enable provisioners to connect to remote resources. Terraform does not store ephemeral values in your plan or state or output them in logs. Refer to the following topics for more information about using ephemeral values in your configurations:

- [`ephemeral` resources](/terraform/language/block/ephemeral)
- [`ephemeral` variables](/terraform/language/block/variable#ephemeral)
- [`ephemeral` output values](/terraform/language/block/output#ephemeral)

## Configure provisioner failure behavior

By default, provisioners that fail also cause the `terraform apply` command to fail. To configure Terraform to continue its operation, set the `on_failure` argument to `continue`. Terraform ignores the error and continues the operation. Refer to the [`on_failure` argument reference](/terraform/language/resource#on_failure) for more information.

In the following, Terraform continues to create the `web` resource even if the `echo` command fails:

```hcl
resource "aws_instance" "web" {
  # ...

  provisioner "local-exec" {
    command    = "echo The server's IP address is ${self.private_ip}"
    on_failure = continue
  }
}
```

## Configure multiple provisioners

You can specify multiple provisioners within a `resource` block. Terraform executes provisioners in the order they are defined in the configuration file.

You can add creation and destruction provisioners to the same `resource` block, but Terraform only runs the provisioners that are valid for a given operation. Terraform runs valid provisioners in the order they're defined in the configuration file.

The following example contains two `local-exec` provisioners that run in order:

<CodeBlockConfig hideClipboard>

```hcl
resource "aws_instance" "web" {
  # ...

  provisioner "local-exec" {
    command = "echo first"
  }

  provisioner "local-exec" {
    command = "echo second"
  }
}
```

</CodeBlockConfig>