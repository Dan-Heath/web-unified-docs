---
page_title: Determine when provisioners run
description: Learn how to control when provisioners perform their configured actions.
---

# Determine when provisioners run

By default, Terraform runs provisioners immediately after it finishes creating the resource, but you can set the `when` argument a Terraform stage control when provisioners perform their configured actions.

## Creation-time provisioners

If a provisioner that runs during resource creation fails, Terraform marks the resource as tainted so that it can destroy and recreate the tainted resource on the next `terraform apply`. Terraform taints resources when a creation-time provisioner fails because a failed provisioner can leave a resource in a semi-configured state. Because Terraform cannot model the provisioner behavior, the only way to ensure proper creation of a resource is to recreate it.

You can change the default tainting behavior by setting the `on_failure` attribute to `continue`. Refer to [`on_failure` argument reference](/terraform/language/block/resource#on_failure) for more information.

## Destroy-time provisioners

To change the default behavior, set the  `when` argument to `destroy`, which configures the provisioner to run when Terraform destroys the parent resource. The following example configures Terraform to run the `echo` command after destroying the `web`:

```hcl
resource "aws_instance" "web" {
  # ...

  provisioner "local-exec" {
    when    = destroy
    command = "echo 'Destroy-time provisioner'"
  }
}
```

Destroy provisioners run before the resource is destroyed. If the provisioner fails, Terraform returns an error and reruns the provisioners on the next `terraform apply`. You should ensure that the destroy-time provisioners are safe to run multiple times.

Enabling the [`create_before_destroy` argument](/terraform/language/block/resource#create_before_destroy) on the resource prevents destroy-time provisioners from running.

### Remove a `resource` block containing a destroy-time provisioner

Destroy-time provisioners can only run if they remain in the configuration at the time a resource is destroyed. If a `resource` block with a destroy-time provisioner is removed entirely from the configuration, its provisioner configurations are removed along with it. The destroy provisioner won't run as a result. To work around this, configure a multi-step process to safely remove a resource with a destroy-time provisioner:

1. Update the resource configuration to include `count = 0`.
1. Apply the configuration to destroy any existing instances of the resource, including running the destroy provisioner.
1. Remove the resource block entirely from configuration, along with its `provisioner` blocks.
1. Apply the configuration again. No further action is necessary because the resources were already destroyed.

Because of this limitation, you should use destroy-time provisioners sparingly and with care.

### Tainted resources

A destroy-time provisioner within a resource that is tainted will not run. This includes resources that are marked tainted from a failed creation-time provisioner or tainted manually using `terraform taint`.