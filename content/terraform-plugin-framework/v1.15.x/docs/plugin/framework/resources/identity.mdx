---
page_title: Identity
description: >-
Learn how to implement resource identity in the Terraform plugin framework.
---

# Resource identity

A resource identity is a data object that is stored alongside the resource instance state to refer to at most one remote object, across all instances of that provider.

## Resource Identity Schema

Practitioners can create an resource identity schema, like the existing managed resource schema, that consists of a map of attribute names and associated behaviours. With a few key differences:

1. The identity schema will only support primitive types and list types such as:
    - `BoolAttribute`
    - `Float32Attribute`
    - `Float64Attribute`
    - `Int32Attribute`
    - `Int64Attribute`
    - `NumberAttribute`
    - `StringAttribute`
    - `ListAttribute`
        - `ElementType: types.BoolType`
        - `ElementType: types.Float32Type`
        - `ElementType: types.Float64Type`
        - `ElementType: types.Int32Type`
        - `ElementType: types.Int64Type`
        - `ElementType: types.NumberType`
        - `ElementType: types.StringType`

NOTE: The ordering in lists is expected to be stable and semantically relevant.

2. Unlike the resource config schema, the resource identity schema will not support behaviours such as Required and Computed. Two new, but similar, behaviours will be allowed for each attribute: `RequiredForImport` and `OptionalForImport`.
 - `RequiredForImport` is set to true if an import block would need this information as part of the identity attribute to import the resource. Some attributes might be specified through other means e.g. the provider configuration and therefore won't be needed for import.

  - `OptionalForImport` is set to true if an import block can provide this information as part of the identity attribute to import the resource. This can be data that would normally be the default of the configured provider running the import. This does not mean the data is omitted from the resource identity, import-only data is not supported.

It is expected that exactly one of `RequiredForImport` or `OptionalForImport` is set to true.

3. Identity attributes are expected to be unique, immutable and fully known.

Example of an identity schema for an aws_s3_bucket:
```go
var _ resource.ResourceWithIdentity = &S3BucketResource{} // new interface

func (r *S3BucketResource) Metadata(_ context.Context, req resource.MetadataRequest, resp *resource.MetadataResponse) {
	resp.TypeName = "aws_s3_bucket"
}

func (r *S3BucketResource) Schema(_ context.Context, _ resource.SchemaRequest, resp *resource.SchemaResponse) {
	resp.Schema = schema.Schema{
		// .. existing resource schema for aws_s3_bucket
	}
}

func (r *S3BucketResource) IdentitySchema(_ context.Context, _ resource.IdentitySchemaRequest, resp *resource.IdentitySchemaResponse) {
	resp.IdentitySchema = identityschema.Schema{
		Attributes: map[string]identityschema.Attribute{
			"bucket": identityschema.StringAttribute{
				RequiredForImport: true,
			},
			"account_id": identityschema.StringAttribute{
				OptionalForImport: true,
			},
			"partition": identityschema.StringAttribute{
				OptionalForImport: true,
			},
			"region": identityschema.StringAttribute{
				OptionalForImport: true,

			},
		},
	}
}
```

## Identity Schema Usage

### Setting an Identity Schema

The provider schema type has a section for identity schemas.

```go
type ProviderSchema struct {
	// ...

	// The schemas for any identities in this provider.
	IdentitySchemas map[string]*IdentitySchema `json:"identity_schemas,omitempty"`
}
```

### Identity Schema Retrieval

The existing `terraform providers schema --json` command now includes all identity schemas in a provider.

```go
type Provider struct {
    // ... other schemas
    ResourceIdentitySchemas  map[string]*IdentitySchema                 `json:"resource_identity_schemas,omitempty"`
}

type IdentitySchema struct {
    Version    uint64                        `json:"version"`
    Attributes map[string]*IdentityAttribute `json:"attributes,omitempty"`
}

type IdentityAttribute struct {
    IdentityType      json.RawMessage `json:"type,omitempty"`
    Description       string          `json:"description,omitempty"`
    RequiredForImport bool            `json:"required_for_import,omitempty"`
    OptionalForImport bool            `json:"optional_for_import,omitempty"`
}
```

### Versioning
Each identity schema will have a version stored alongside the identity data in the state, similar to resource schemas. We don't expect the identity schema for a resource to change very often, although it could happen. In that case, we will need an upgrade method for identities, similar to resource state.

##### Example
Using an example identity schema for an AWS S3 bucket the identity schema version 0 could look like the following:
```go
{
    "account_id": {string, required_for_import:false, optional_for_import:true},
    "partition": {string, required_for_import:false, optional_for_import:true},
    "service": {string, required_for_import:false, optional_for_import:true},
    "region": {string, required_for_import:false, optional_for_import:true},
    "bucket": {string, required_for_import:true, optional_for_import:false},
}
```

Each resource instance will have a populated identity in the Terraform state that follows this schema:
```go
{
  // ...
  "resources": [
    {
      "type": "aws_s3_bucket",
      // ...
      "instances": [
        {
          // ...
          "schema_version": 0,
          "attributes": {
            // ...
          },
          "identity_schema_version": 0,
          "identity": {
            "account_id": "123456789012",
            "partition": "aws",
            "service": "s3",
            "region": "us-east-1",
            "bucket": "bucket-name"
          }
        }
      ]
    }
  ]
}
```
If at any point the S3 team decides that a different attribute is required to uniquely identify buckets, the identity schema must be updated accordingly and its version increased to 1:

```go
{
    "account_id": {string, required_for_import:false, optional_for_import:true},
    "partition": {string, required_for_import:false, optional_for_import:true},
    "service": {string, required_for_import:false, optional_for_import:true},
    "region": {string, required_for_import:false, optional_for_import:true},
    "bucket": {string, required_for_import:true, optional_for_import:false},
    "planet": {string, required_for_import:true, optional_for_import:false},
}
```

The next time Terraform interacts with this resource, it will update the identity data using a new RPC call to the provider. The updated identity data is persisted in the state along with the incremented version number:
```go
// ...
"identity_schema_version": 1,
"identity": {
  "account_id": "123456789012",
  "partition": "aws",
  "service": "s3",
  "region": "us-east-1",
  "bucket": "bucket-name",
  "planet": "earth"
}
// ...
```
Before comparing identity data from the state, it should be ensured that it always follows the latest schema version.


## Example Identities

Some illustrations of what an identity data object might look like for some common resource types.

##### GCP
###### google_project_service
Example schema:
```go
{
  "project": {string, required_for_import:true},
  "service": {string, required_for_import:true},
}
```

Example identity data:
```go
{
  project = "my-proj-id"
  service = "iam.google.apis.com"
}
```

###### google_project_iam_member
Example schema:
```go
{
  "project": {string, required_for_import:true},
  "role": {string, required_for_import:true},
  "member": {string, required_for_import:true},
}
```

Example identity data:
```go
{
  project = "my-proj-id"
  role = "roles/viewer"
  member = "foo@example.com"
}
```

##### google_service_account
Example schema:
```go
{
  "project": {string, required_for_import:true},
  "email": {string, required_for_import:true},
}
```


Example identity data:
```go
{
  project = "my-proj-id"
  email = "foo@example.com"
}
```

#### AWS
##### aws_iam_role
```go
Example schema:
{
  "name": {string, required_for_import:true},
  "account_id": {string, required_for_import:false},
  "partition": {string, required_for_import:false},
}
```

Example identity data:
```go
{
  "account_id": "123456789012",
  "partition": "aws",
  "name": "role-name"
}
```

##### aws_iam_role_policy_attachment
Example schema:
```go
{
  "role": {string, required_for_import:true},
  "policy_arn": {string, required_for_import:true},
  "account_id": {string, required_for_import:false},
  "partition": {string, required_for_import:false},
}
```

Example identity data:
```go
{
  "account_id": "123456789012",
  "partition": "aws",
  "policy_arn": "arn:aws:iam::xxxxxxxxxxxx:policy/test-policy",
  "role": "test-role",
}
```

##### aws_s3_bucket
Example schema:
```go
{
  "account_id": {string, required_for_import:false},
  "partition": {string, required_for_import:false},
  "region": {string, required_for_import:false},
  "bucket": {string, required_for_import:true},
}
```go

Example identity data:
```go
{
  "account_id": "123456789012",
  "partition": "aws",
  "region": "us-east-1",
  "bucket" = "bucket-name"
}
```

Example import block:
```go
import {
  to = aws_s3_bucket.foo
  identity = {
    bucket = "bucket-name"
  }
}
```

##### aws_route53_record
Example schema:
```go
{
  "account_id": {string, required_for_import:false},
  "partition": {string, required_for_import:false},
  "zone_id": {string, required_for_import:true},
  "record_name": {string, required_for_import:true},
  "record_type": {string, required_for_import:true},
}
```

Example identity data:
```go
{
  "account_id": "123456789012",
  "partition": "aws",
  "zone_id" = "Z4KAPRWWNC7JR",
  "record_name" = "dev.example.com",
  "record_type" = "NS"
}
```

#### AzureRM

##### azurerm_virtual_network

Example schema:
```go
{
  "subscription_id": {string, required_for_import:true},
  "resource_group_name": {string, required_for_import:true},
  "virtual_network_name": {string, required_for_import:true},
}
```

Example identity data:
```go
{
  "subscription_id": "00000000-0000-0000-0000-000000000000",
  "resource_group_name": "exampleGroup",
  "virtual_network_name": "exampleVNet",
}
```

##### azurerm_role_definition
Example schema:
```go
{
  "scope_id": {string, required_for_import:true},
  "role_definition_id": {string, required_for_import:true},
}
```

Example identity data:
```go
{
  "scope_id": "/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/myGroup",
  "role_definition_id": "/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/roleDefinitions/00000000-0000-0000-0000-000000000000",
}
```

##### azurerm_role_assignment
Example schema:
```go
{
  "scope_id": {string, required_for_import:true},
  "role_assignment_id": {string, required_for_import:true},
}
```

Example identity data:
```go
{
  "scope_id": "/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/exampleGroup",
  "role_assignment_id": "/providers/Microsoft.Authorization/roleAssignments/00000000-0000-0000-0000-000000000000",
}
```

#### AzureAD

##### azuread_group
Example schema:
```go
{
  "object_id": {string, required_for_import:true},
}
```

Example identity data:
```go
{
  object_id = "00000000-0000-0000-0000-000000000000"
}
```

##### Azuread_group_member
Example schema:
```go
{
  "group_object_id": {string, required_for_import:true},
  "member_object_id": {string, required_for_import:true},
}
```

Example identity data:
```go
{
  group_object_id = "00000000-0000-0000-0000-000000000000"
  member_object_id = "11111111-1111-1111-1111-111111111111"
}
```
##### azuread_application
Example schema:
```go
{
  "object_id": {string, required_for_import:true},
}
```

Example identity data:
```go
{
  object_id = "00000000-0000-0000-0000-000000000000"
}
```
##### azuread_app_role_assignment
Example schema:
```go
{
  "principal_object_id": {string, required_for_import:true},
  "app_role_id": {string, required_for_import:true},
}
```

Example identity data:
```go
{
  principal_object_id = "00000000-0000-0000-0000-000000000000"
  app_role_id = "aaBBcDDeFG6h5JKLMN2PQrrssTTUUvWWxxxxxyyyzzz"
}
```