---
layout: docs
page_title: SPIFFE - Auth Methods
description: >-
  The SPIFFE auth method allows users to authenticate with
  Vault using JWT and X.509 based SPIFFE SVIDs
---

# SPIFFE auth method

@include 'alerts/enterprise-only.mdx'

The `spiffe` auth method allows authentication using JWT or x.509 based SPIFFE SVIDs
whose trust can be rooted within a configured trust bundle.

Please note that to use this auth method with x.509 SPIFFE IDs, `tls_disable` and
`tls_disable_client_certs` must be false in the Vault configuration. This is because
the certificates are sent through TLS communication itself. See the [note below](#load-balancing)
if your Vault server is behind a load balancer or proxy.

## Configuration

Each SPIFFE backend instance is configured with a single trust domain and
an associated trust bundle. The trust bundle can be provided directly as
part of the configuration, or fetched from a remote endpoint over HTTPS. See
the [SPIFFE Config API](/vault/api-docs/auth/spiffe#create-configuration) for
details on the different profiles supported.

Further configuration at the role level is required to map SPIFFE workload IDs
to a Vault token policy. See the [SPIFFE Role API](/vault/api-docs/auth/spiffe#create-role)
for details on configuring roles.

## Integration with SPIRE

If you are using [SPIRE](https://spiffe.io/spire/) to issue SPIFFE SVIDs,
Vault can be configured to fetch the trust bundle directly from the SPIRE
Federation API.

Vault supports SPIRE's `https_web` and `https_spiffe` Federation endpoint types,
see the [SPIFFE Config API](/vault/api-docs/auth/spiffe#create-configuration)
for details on configuring Vault to fetch the trust bundle from SPIRE.

## Implementation notes

### Set passthrough request header for JWT SPIFFE SVIDs

For JWT based SPIFFE SVIDs, the SVID must be provided in the
`Authorization` header as a Bearer token. The `Authorization` header
must be included in the set of passthrough request headers for the SPIFFE
auth method mount.

When enabling the SPIFFE auth method, you can specify the passthrough
header.
```shell
$ vault auth enable -passthrough-request-headers="Authorization" spiffe
```

If the SPIFFE auth method is already enabled, you can tune the mount to
add the passthrough header.

```shell
$ vault auth tune -passthrough-request-headers="Authorization" spiffe
```

Example header:
```
Authorization: Bearer <svid-jwt>
```

### Audience required for JWT SPIFFE SVIDs

When using JWT based SPIFFE SVIDs, the [audience](/vault/api-docs/auth/spiffe#audience)
parameter must be configured to a set of allowed values. Any matching
element within the array will be allowed to authenticate. If empty, all
JWT based SVIDS will be denied.

### Trust bundle formats

To support both JWT and x.509 based SPIFFE IDs, the trust bundle provided statically
or fetched from a remote endpoint must contain both X.509 certificate(s) along with
JWK key(s) within a JWKS document.

If the trust bundle is a PEM encoded X.509 certificate, only x.509 based SPIFFE IDs
are supported.

### Refreshing remote trust bundles

When using a profile that fetches the trust bundle from a remote endpoint, the trust
bundle is cached locally and is refreshed periodically. Refresh intervals are calculated
based on the bundle's refresh hint (if provided) or a default of 1 hour.

If an immediate refresh is required, call the [configuration endpoint](/vault/api-docs/auth/spiffe#create-configuration)
with an empty payload to force a refresh.

The active node within a Vault cluster performs the initial fetch and subsequent
refreshes on the trust bundle on behalf of all nodes in the cluster. The active node
on Performance replica clusters will fetch and refresh the trust bundle independently.

Details on the fetched trust bundle, including the last refresh time and the
refresh interval are available via the [read configuration endpoint](/vault/api-docs/auth/spiffe#read-configuration).

### Load Balancing / Proxying Consideration

If the Vault server is fronted by a reverse proxy or load balancer, TLS is
terminated before Vault.  In that case the proxy must provide the validated
client certificate via header, and [configured in the Vault configuration's
listener stanza](/vault/docs/configuration/listener/tcp#tcp-listener-parameters).

Configure the listener with the header name that your load balancer provides.
In this mode, the security of authentication depends on the load balancer performing
full TLS verification to the client, and that the connection between the load
balancer and Vault is secured, ideally with Mutual TLS.

## API

The SPIFFE auth method has a full HTTP API. Refer to the [SPIFFE auth API documentation](/vault/api-docs/auth/spiffe) for more details.
